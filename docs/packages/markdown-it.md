# @shikijs/markdown-it

<Badges name="@shikijs/markdown-it" />

用于 Shiki 的 [markdown-it](https://markdown-it.github.io/) 插件。

## 安装

::: code-group

```sh [npm]
npm i -D @shikijs/markdown-it
```

```sh [yarn]
yarn add -D @shikijs/markdown-it
```

```sh [pnpm]
pnpm add -D @shikijs/markdown-it
```

```sh [bun]
bun add -D @shikijs/markdown-it
```

```sh [deno]
deno add npm:@shikijs/markdown-it
```

:::

## 用法

```ts twoslash
// @twoslash-cache: {"v":1,"hash":"959709c97c288ea5ed5a231f28e5eebf48f1676e9c76559e68208cb76e2b6711","data":"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"}
import Shiki from '@shikijs/markdown-it'
import MarkdownIt from 'markdown-it'

const md = MarkdownIt()

md.use(await Shiki({
  themes: {
    light: 'vitesse-light',
    dark: 'vitesse-dark',
  }
}))
```

## 细粒捆绑预设

默认情况下，将导入 `shiki` 的完整 bundle。如果你使用的是[细粒捆绑预设](/guide/bundles#细粒捆绑预设)，你可以从 `@shikijs/markdown-it/core` 导入并传递你自己的 Highlighter：

```ts twoslash
// @twoslash-cache: {"v":1,"hash":"4cce3b72c2224ceff07c637806719480ab0b5bcdb0fafc8ad599ec8c8ad5d255","data":"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"}
// @noErrors: true
import { fromHighlighter } from '@shikijs/markdown-it/core'
import MarkdownIt from 'markdown-it'
import { createHighlighterCore } from 'shiki/core'
import { createOnigurumaEngine } from 'shiki/engine/oniguruma'

const highlighter = await createHighlighterCore({
  themes: [
    import('@shikijs/themes/vitesse-light')
  ],
  langs: [
    import('@shikijs/langs/javascript'),
  ],
  engine: createOnigurumaEngine(() => import('shiki/wasm'))
})

const md = MarkdownIt()

md.use(fromHighlighter(highlighter, { /* options */ }))
```

## 使用 Shorthands

Shiki 的 [shorthands](/guide/shorthands) 提供按需加载主题和语言的功能，但也使高亮过程变为异步。不幸的是，`markdown-it` 本身[不支持异步高亮](https://github.com/markdown-it/markdown-it/blob/master/docs/development.md#i-need-async-rule-how-to-do-it)。

为了解决这个问题，你可以使用 [Anthony Fu](https://github.com/antfu) 的 [`markdown-it-async`](https://github.com/antfu/markdown-it-async)。Shiki 也提供了与它的集成，你可以从 `@shikijs/markdown-it/async` 导入 `fromAsyncCodeToHtml`。

````ts twoslash
// @twoslash-cache: {"v":1,"hash":"c01b53be80d5d9138602197a545e256fa208a1780412708628a94daf8ccf2b07","data":"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"}
import { fromAsyncCodeToHtml } from '@shikijs/markdown-it/async'
import MarkdownItAsync from 'markdown-it-async'
import { codeToHtml } from 'shiki' // 或你的自定义 shorthand bundle

// 使用 markdown-it-async 初始化 MarkdownIt 实例
const md = MarkdownItAsync()

md.use(
  fromAsyncCodeToHtml(
    // 传递 codeToHtml 函数
    codeToHtml,
    {
      themes: {
        light: 'vitesse-light',
        dark: 'vitesse-dark',
      }
    }
  )
)

// 使用 `md.renderAsync` 代替 `md.render`
const html = await md.renderAsync('# Title\n```ts\nconsole.log("Hello, World!")\n```')
````

## 变换器（Transformer）注意事项

`markdown-it` 默认会将 `<pre><code>` 作为代码块 HTML 的最外层包裹元素。如果你使用自定义的 Shiki [变换器](/guide/transformers)，这种行为可能并不理想。例如，如果变换器生成了

```html
<div class="fenced-code-block">
  <pre>
    <code>
      …
    </code>
  </pre>
</div>
```

那么经过 `markdown-it` 处理后，结果会变成

```html
<pre>
  <code>
    <div class="fenced-code-block">
      <pre>
        <code>
          …
        </code>
      </pre>
    </div>
  </code>
</pre>
```

你可以通过在 `markdown-it` 配置中添加 [olets/markdown-it-wrapperless-fence-rule](https://github.com/olets/markdown-it-wrapperless-fence-rule) 来规避这种情况，或者编写你自己的 `markdown-it` fence 规则（参考 [markdown-it#269](https://github.com/markdown-it/markdown-it/issues/269)）。
